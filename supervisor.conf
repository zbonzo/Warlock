[supervisord]
nodaemon=true                             ; Run Supervisor in the foreground (required for Docker)
logfile=/var/log/supervisor/supervisord.log ; Main log file for Supervisor
pidfile=/var/run/supervisord.pid          ; PID file for Supervisor
loglevel=info                             ; Log level for Supervisor

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"  ; Command to start Nginx in the foreground
autostart=true
autorestart=true
priority=10                               ; Nginx starts before the node server (lower number = higher priority)
stdout_logfile=/var/log/supervisor/nginx_stdout.log
stderr_logfile=/var/log/supervisor/nginx_stderr.log
user=root                                 ; Nginx master process needs root to bind to port 80

[program:nodeserver]
command=node index.js                    ; Command to start your Node.js server
directory=/opt/app/backend                ; Working directory for your Node.js server
autostart=true
autorestart=true
priority=20
stdout_logfile=/var/log/supervisor/nodeserver_stdout.log
stderr_logfile=/var/log/supervisor/nodeserver_stderr.log
user=appuser                              ; Run Node.js server as the non-root 'appuser'
environment=NODE_ENV="production",PORT="3001" ; Environment variables for your Node.js server